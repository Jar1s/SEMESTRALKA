<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="sk.ikts.client.controller.DashboardController"
            stylesheets="@../styles/modern.css"
            styleClass="main-background">
    
    <!-- Top: Status bar -->
    <top>
        <HBox spacing="15" alignment="CENTER_LEFT" styleClass="top-bar">
            <Label text="CALLSTUDY"
                   styleClass="title-label"
                   style="-fx-text-fill: white; -fx-font-size: 20px;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="statusLabel" text="Loading..."
                   style="-fx-text-fill: white; -fx-font-size: 12px;"/>
            <Button fx:id="profileButton" text="Profile" onAction="#showProfileDialog"
                    styleClass="modern-button"/>
            <Button fx:id="logoutButton" text="Logout" onAction="#handleLogout"
                    styleClass="danger-button"/>
            <Button fx:id="refreshButton" text="Refresh" onAction="#handleRefresh"
                    styleClass="success-button"/>
        </HBox>
    </top>
    
    <!-- Center: TabPane with Groups, Tasks, Statistics -->
    <center>
        <TabPane fx:id="mainTabPane" tabClosingPolicy="UNAVAILABLE">
            <tabs>
                <!-- Groups Tab -->
                <Tab text="Groups">
                    <TabPane tabClosingPolicy="UNAVAILABLE">
                        <tabs>
                            <!-- All Groups Tab -->
                            <Tab text="All Groups">
                                <VBox spacing="12">
                                    <padding>
                                        <Insets top="12" right="12" bottom="12" left="12"/>
                                    </padding>
                                    <children>
                                        <HBox spacing="12" alignment="CENTER_LEFT">
                                            <Label text="All Study Groups" 
                                                   styleClass="section-label"/>
                                            <Region HBox.hgrow="ALWAYS"/>
                                            <Button fx:id="createGroupButton" text="Create Group" 
                                                    onAction="#showCreateGroupDialog"
                                                    styleClass="success-button"/>
                                        </HBox>
                                        
                                        <TableView fx:id="allGroupsTable" prefHeight="500" styleClass="table-view">
                                            <columns>
                                                <TableColumn fx:id="allGroupNameColumn" text="Name" prefWidth="180"/>
                                                <TableColumn fx:id="allGroupDescriptionColumn" text="Description" prefWidth="250"/>
                                                <TableColumn fx:id="allGroupOwnerColumn" text="Owner" prefWidth="150"/>
                                                <TableColumn fx:id="allGroupCreatedColumn" text="Created" prefWidth="130"/>
                                                <TableColumn fx:id="allGroupActionsColumn" text="Actions" prefWidth="180"/>
                                            </columns>
                                        </TableView>
                                    </children>
                                </VBox>
                            </Tab>
                            
                            <!-- My Groups Tab -->
                            <Tab text="My Groups">
                                <VBox spacing="12">
                                    <padding>
                                        <Insets top="12" right="12" bottom="12" left="12"/>
                                    </padding>
                                    <children>
                                        <HBox spacing="12" alignment="CENTER_LEFT">
                                            <Label text="My Study Groups" 
                                                   styleClass="section-label"/>
                                            <Region HBox.hgrow="ALWAYS"/>
                                        </HBox>
                                        
                                        <TableView fx:id="myGroupsTable" prefHeight="500" styleClass="table-view">
                                            <columns>
                                                <TableColumn fx:id="myGroupNameColumn" text="Name" prefWidth="180"/>
                                                <TableColumn fx:id="myGroupDescriptionColumn" text="Description" prefWidth="250"/>
                                                <TableColumn fx:id="myGroupOwnerColumn" text="Owner" prefWidth="150"/>
                                                <TableColumn fx:id="myGroupCreatedColumn" text="Created" prefWidth="130"/>
                                                <TableColumn fx:id="myGroupActionsColumn" text="Actions" prefWidth="200"/>
                                            </columns>
                                        </TableView>
                                    </children>
                                </VBox>
                            </Tab>
                        </tabs>
                    </TabPane>
                </Tab>
                
                <!-- Tasks Tab -->
                <Tab text="Tasks">
                    <VBox spacing="12">
                        <padding>
                            <Insets top="12" right="12" bottom="12" left="12"/>
                        </padding>
                        <children>
                            <HBox spacing="12" alignment="CENTER_LEFT">
                                <Label text="All Tasks" 
                                       styleClass="section-label"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <ComboBox fx:id="groupFilterComboBox" promptText="Filter by Group" 
                                          prefWidth="200" styleClass="combo-box"/>
                                <Button fx:id="createTaskButton" text="Create Task" 
                                        onAction="#showCreateTaskDialog"
                                        styleClass="modern-button"/>
                            </HBox>
                            
                            <TableView fx:id="tasksTable" prefHeight="500" styleClass="table-view">
                                <columns>
                                    <TableColumn fx:id="taskTitleColumn" text="Title" prefWidth="200"/>
                                    <TableColumn fx:id="taskGroupColumn" text="Group" prefWidth="150"/>
                                    <TableColumn fx:id="taskDeadlineColumn" text="Deadline" prefWidth="150"/>
                                    <TableColumn fx:id="taskActionsColumn" text="Actions" prefWidth="200"/>
                                </columns>
                            </TableView>
                        </children>
                    </VBox>
                </Tab>
                
                <!-- Statistics Tab -->
                <Tab text="Statistics">
                    <ScrollPane fitToWidth="true">
                        <VBox spacing="15" alignment="CENTER">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>
                            <children>
                                <Label text="Dashboard Statistics" 
                                       styleClass="title-label"/>
                                
                                <GridPane hgap="15" vgap="15">
                                    <columnConstraints>
                                        <ColumnConstraints prefWidth="250"/>
                                        <ColumnConstraints prefWidth="250"/>
                                    </columnConstraints>
                                    
                                    <children>
                                        <VBox spacing="10" styleClass="stat-card">
                                            <Label text="Total Groups" styleClass="stat-label"/>
                                            <Label fx:id="totalGroupsLabel" text="0" 
                                                   styleClass="stat-value"/>
                                        </VBox>
                                        
                                        <VBox spacing="10" styleClass="stat-card">
                                            <Label text="Total Tasks" styleClass="stat-label"/>
                                            <Label fx:id="totalTasksLabel" text="0" 
                                                   styleClass="stat-value" style="-fx-text-fill: #000000;"/>
                                        </VBox>
                                        
                                        <VBox spacing="10" styleClass="stat-card">
                                            <Label text="Open Tasks" styleClass="stat-label"/>
                                            <Label fx:id="openTasksLabel" text="0" 
                                                   styleClass="stat-value" style="-fx-text-fill: #000000;"/>
                                        </VBox>
                                        
                                        <VBox spacing="10" styleClass="stat-card">
                                            <Label text="Completed Tasks" styleClass="stat-label"/>
                                            <Label fx:id="completedTasksLabel" text="0" 
                                                   styleClass="stat-value" style="-fx-text-fill: #000000;"/>
                                        </VBox>
                                    </children>
                                </GridPane>
                                
                                <Label text="Task Completion Ratio" 
                                       styleClass="section-label"/>
                                <VBox spacing="8" styleClass="card" style="-fx-pref-width: 500;">
                                    <Label fx:id="completionRatioLabel" text="0%" 
                                           style="-fx-font-size: 48px; -fx-font-weight: bold; -fx-text-fill: #000000; -fx-alignment: center;"/>
                                    <ProgressBar fx:id="completionProgressBar" prefWidth="450" progress="0" styleClass="progress-bar"/>
                                    <Label text="Tasks completed vs total tasks" 
                                           styleClass="stat-label"/>
                                </VBox>
                                
                                <Label text="Task Status Distribution" 
                                       styleClass="section-label"/>
                                <VBox spacing="8" styleClass="card" style="-fx-pref-width: 500;">
                                    <PieChart fx:id="taskStatusPieChart" prefWidth="450" prefHeight="280"/>
                                </VBox>
                                
                                <Label text="Tasks by Status" 
                                       styleClass="section-label"/>
                                <VBox spacing="8" styleClass="card" style="-fx-pref-width: 500;">
                                    <BarChart fx:id="taskStatusBarChart" prefWidth="450" prefHeight="280">
                                        <xAxis>
                                            <CategoryAxis fx:id="statusCategoryAxis" label="Status"/>
                                        </xAxis>
                                        <yAxis>
                                            <NumberAxis fx:id="taskCountAxis" label="Number of Tasks"/>
                                        </yAxis>
                                    </BarChart>
                                </VBox>
                                
                                <Label text="Tasks by Group" 
                                       styleClass="section-label"/>
                                <VBox spacing="8" styleClass="card" style="-fx-pref-width: 500;">
                                    <BarChart fx:id="tasksByGroupBarChart" prefWidth="450" prefHeight="280">
                                        <xAxis>
                                            <CategoryAxis fx:id="groupCategoryAxis" label="Group"/>
                                        </xAxis>
                                        <yAxis>
                                            <NumberAxis fx:id="groupTaskCountAxis" label="Number of Tasks"/>
                                        </yAxis>
                                    </BarChart>
                                </VBox>
                                
                                <Label text="Activity Summary" 
                                       styleClass="section-label"/>
                                <VBox spacing="8" styleClass="card" style="-fx-pref-width: 500;">
                                    <VBox fx:id="activitySummaryBox" spacing="5"/>
                                </VBox>
                            </children>
                        </VBox>
                    </ScrollPane>
                </Tab>
                
                <!-- Settings Tab -->
                <Tab text="Settings">
                    <ScrollPane fitToWidth="true">
                        <VBox spacing="15" alignment="CENTER">
                            <padding>
                                <Insets top="15" right="15" bottom="15" left="15"/>
                            </padding>
                            <children>
                                <Label text="Settings" 
                                       styleClass="title-label"/>
                                
                                <VBox spacing="12" styleClass="card" style="-fx-pref-width: 500;">
                                    <Label text="Profile Settings" 
                                           styleClass="section-label"/>
                                    
                                    <VBox spacing="8">
                                        <Label text="Change Name:" style="-fx-font-size: 14px; -fx-text-fill: #495057;"/>
                                        <TextField fx:id="settingsNameField" promptText="Enter new name" styleClass="modern-text-field"/>
                                        <Button fx:id="updateNameButton" text="Update Name" 
                                                onAction="#handleUpdateName"
                                                styleClass="modern-button"/>
                                    </VBox>
                                    
                                    <Separator styleClass="separator"/>
                                    
                                    <VBox spacing="8">
                                        <Label text="Change Password:" style="-fx-font-size: 14px; -fx-text-fill: #495057;"/>
                                        <PasswordField fx:id="settingsPasswordField" promptText="Enter new password" styleClass="modern-text-field"/>
                                        <PasswordField fx:id="settingsConfirmPasswordField" promptText="Confirm new password" styleClass="modern-text-field"/>
                                        <Button fx:id="updatePasswordButton" text="Update Password" 
                                                onAction="#handleUpdatePassword"
                                                styleClass="success-button"/>
                                    </VBox>
                                </VBox>
                                
                                <VBox spacing="12" styleClass="card" style="-fx-pref-width: 500;">
                                    <Label text="User Profiles" 
                                           styleClass="section-label"/>
                                    
                                    <TableView fx:id="usersTable" prefHeight="400" styleClass="table-view">
                                        <columns>
                                            <TableColumn fx:id="userNameColumn" text="Name" prefWidth="200"/>
                                            <TableColumn fx:id="userEmailColumn" text="Email" prefWidth="250"/>
                                        </columns>
                                    </TableView>
                                </VBox>
                            </children>
                        </VBox>
                    </ScrollPane>
                </Tab>
            </tabs>
        </TabPane>
    </center>
</BorderPane>

