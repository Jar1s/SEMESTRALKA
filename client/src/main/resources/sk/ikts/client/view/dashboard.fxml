<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="sk.ikts.client.controller.DashboardController"
            stylesheets="@../styles/modern.css"
            styleClass="main-background">
    
    <!-- Top: Status bar -->
    <top>
        <HBox spacing="15" alignment="CENTER_LEFT" styleClass="top-bar">
            <Label text="ðŸ“š Collaborative Study Platform"
                   styleClass="title-label"
                   style="-fx-text-fill: white; -fx-font-size: 20px;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="statusLabel" text="Loading..."
                   style="-fx-text-fill: white; -fx-font-size: 12px;"/>
            <Button fx:id="profileButton" text="ðŸ‘¤ Profile" onAction="#showProfileDialog"
                    styleClass="modern-button"/>
            <Button fx:id="refreshButton" text="ðŸ”„ Refresh" onAction="#handleRefresh"
                    styleClass="success-button"/>
        </HBox>
    </top>
    
    <!-- Center: TabPane with Groups, Tasks, Statistics -->
    <center>
        <TabPane fx:id="mainTabPane" tabClosingPolicy="UNAVAILABLE">
            <tabs>
                <!-- Groups Tab -->
                <Tab text="Groups">
                    <VBox spacing="10">
                        <padding>
                            <Insets top="10" right="10" bottom="10" left="10"/>
                        </padding>
                        <children>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="ðŸ“ My Study Groups" 
                                       styleClass="section-label"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button fx:id="createGroupButton" text="âž• Create Group" 
                                        onAction="#showCreateGroupDialog"
                                        styleClass="success-button"/>
                            </HBox>
                            
                            <TableView fx:id="groupsTable" prefHeight="500" styleClass="table-view">
                                <columns>
                                    <TableColumn fx:id="groupNameColumn" text="Name" prefWidth="200"/>
                                    <TableColumn fx:id="groupDescriptionColumn" text="Description" prefWidth="300"/>
                                    <TableColumn fx:id="groupCreatedColumn" text="Created" prefWidth="150"/>
                                    <TableColumn fx:id="groupActionsColumn" text="Actions" prefWidth="200"/>
                                </columns>
                            </TableView>
                        </children>
                    </VBox>
                </Tab>
                
                <!-- Tasks Tab -->
                <Tab text="Tasks">
                    <VBox spacing="10">
                        <padding>
                            <Insets top="10" right="10" bottom="10" left="10"/>
                        </padding>
                        <children>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="âœ… All Tasks" 
                                       styleClass="section-label"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <ComboBox fx:id="groupFilterComboBox" promptText="Filter by Group" 
                                          prefWidth="200" styleClass="combo-box"/>
                                <Button fx:id="createTaskButton" text="âž• Create Task" 
                                        onAction="#showCreateTaskDialog"
                                        styleClass="modern-button"/>
                            </HBox>
                            
                            <TableView fx:id="tasksTable" prefHeight="500" styleClass="table-view">
                                <columns>
                                    <TableColumn fx:id="taskTitleColumn" text="Title" prefWidth="200"/>
                                    <TableColumn fx:id="taskGroupColumn" text="Group" prefWidth="150"/>
                                    <TableColumn fx:id="taskStatusColumn" text="Status" prefWidth="120"/>
                                    <TableColumn fx:id="taskDeadlineColumn" text="Deadline" prefWidth="150"/>
                                    <TableColumn fx:id="taskActionsColumn" text="Actions" prefWidth="200"/>
                                </columns>
                            </TableView>
                        </children>
                    </VBox>
                </Tab>
                
                <!-- Statistics Tab -->
                <Tab text="Statistics">
                    <ScrollPane fitToWidth="true">
                        <VBox spacing="20" alignment="CENTER">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <children>
                                <Label text="ðŸ“Š Dashboard Statistics" 
                                       styleClass="title-label"/>
                                
                                <GridPane hgap="20" vgap="20">
                                    <columnConstraints>
                                        <ColumnConstraints prefWidth="250"/>
                                        <ColumnConstraints prefWidth="250"/>
                                    </columnConstraints>
                                    
                                    <children>
                                        <VBox spacing="10" styleClass="stat-card">
                                            <Label text="Total Groups" styleClass="stat-label"/>
                                            <Label fx:id="totalGroupsLabel" text="0" 
                                                   styleClass="stat-value"/>
                                        </VBox>
                                        
                                        <VBox spacing="10" styleClass="stat-card">
                                            <Label text="Total Tasks" styleClass="stat-label"/>
                                            <Label fx:id="totalTasksLabel" text="0" 
                                                   styleClass="stat-value" style="-fx-text-fill: #4facfe;"/>
                                        </VBox>
                                        
                                        <VBox spacing="10" styleClass="stat-card">
                                            <Label text="Open Tasks" styleClass="stat-label"/>
                                            <Label fx:id="openTasksLabel" text="0" 
                                                   styleClass="stat-value" style="-fx-text-fill: #f5576c;"/>
                                        </VBox>
                                        
                                        <VBox spacing="10" styleClass="stat-card">
                                            <Label text="Completed Tasks" styleClass="stat-label"/>
                                            <Label fx:id="completedTasksLabel" text="0" 
                                                   styleClass="stat-value" style="-fx-text-fill: #00f2fe;"/>
                                        </VBox>
                                    </children>
                                </GridPane>
                                
                                <Label text="Task Completion Ratio" 
                                       styleClass="section-label"/>
                                <VBox spacing="10" styleClass="card" style="-fx-pref-width: 500;">
                                    <Label fx:id="completionRatioLabel" text="0%" 
                                           style="-fx-font-size: 48px; -fx-font-weight: bold; -fx-text-fill: #667eea; -fx-alignment: center;"/>
                                    <ProgressBar fx:id="completionProgressBar" prefWidth="450" progress="0" styleClass="progress-bar"/>
                                    <Label text="Tasks completed vs total tasks" 
                                           styleClass="stat-label"/>
                                </VBox>
                            </children>
                        </VBox>
                    </ScrollPane>
                </Tab>
                
                <!-- Settings Tab -->
                <Tab text="Settings">
                    <ScrollPane fitToWidth="true">
                        <VBox spacing="20" alignment="CENTER">
                            <padding>
                                <Insets top="20" right="20" bottom="20" left="20"/>
                            </padding>
                            <children>
                                <Label text="âš™ï¸ Settings" 
                                       styleClass="title-label"/>
                                
                                <VBox spacing="15" styleClass="card" style="-fx-pref-width: 500;">
                                    <Label text="ðŸ‘¤ Profile Settings" 
                                           styleClass="section-label"/>
                                    
                                    <VBox spacing="10">
                                        <Label text="Change Name:" style="-fx-font-size: 14px; -fx-text-fill: #495057;"/>
                                        <TextField fx:id="settingsNameField" promptText="Enter new name" styleClass="modern-text-field"/>
                                        <Button fx:id="updateNameButton" text="Update Name" 
                                                onAction="#handleUpdateName"
                                                styleClass="modern-button"/>
                                    </VBox>
                                    
                                    <Separator styleClass="separator"/>
                                    
                                    <VBox spacing="10">
                                        <Label text="Change Password:" style="-fx-font-size: 14px; -fx-text-fill: #495057;"/>
                                        <PasswordField fx:id="settingsPasswordField" promptText="Enter new password" styleClass="modern-text-field"/>
                                        <PasswordField fx:id="settingsConfirmPasswordField" promptText="Confirm new password" styleClass="modern-text-field"/>
                                        <Button fx:id="updatePasswordButton" text="Update Password" 
                                                onAction="#handleUpdatePassword"
                                                styleClass="success-button"/>
                                    </VBox>
                                </VBox>
                                
                                <VBox spacing="15" styleClass="card" style="-fx-pref-width: 500;">
                                    <Label text="ðŸ‘¥ User Profiles" 
                                           styleClass="section-label"/>
                                    
                                    <TableView fx:id="usersTable" prefHeight="400" styleClass="table-view">
                                        <columns>
                                            <TableColumn fx:id="userNameColumn" text="Name" prefWidth="200"/>
                                            <TableColumn fx:id="userEmailColumn" text="Email" prefWidth="250"/>
                                        </columns>
                                    </TableView>
                                </VBox>
                            </children>
                        </VBox>
                    </ScrollPane>
                </Tab>
            </tabs>
        </TabPane>
    </center>
</BorderPane>

